<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kas Masjid - Simpel</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <!-- Content of the page (same as before) -->
    <h3 class="m-0">Kas Masjid (Simpel)</h3>
    <!-- The rest of the form and table here -->
  </div>

  <script>
    // Ganti dengan URL Web App Google Apps Script kamu
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzSVWG1ncqwu5A4UDhIYUubX84C18ya0QIY9rYtPN03QehsX2I5-hIa3Y0GzTqJ-CgW/exec'; 

    // Fungsi untuk mengirim data transaksi ke Google Sheets
    function saveDataToGoogleSheets(data) {
      const params = new URLSearchParams();
      params.append('action', 'addTransaction');
      params.append('tgl', data.tgl);
      params.append('tipe', data.tipe);
      params.append('kategori', data.kategori);
      params.append('keterangan', data.keterangan);
      params.append('jumlah', data.jumlah);

      fetch(WEB_APP_URL, {
        method: 'POST',
        body: params
      })
      .then(response => response.json())
      .then(result => {
        console.log('Data berhasil disimpan:', result);
        alert('Transaksi berhasil disimpan');
        refresh();
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Gagal menyimpan transaksi');
      });
    }

    // Fungsi untuk mengambil data transaksi dari Google Sheets
    function fetchDataFromGoogleSheets() {
      const params = new URLSearchParams();
      params.append('action', 'getTransactions');

      fetch(WEB_APP_URL + '?' + params.toString())
        .then(response => response.json())
        .then(data => {
          console.log('Data transaksi:', data);
          renderTable(data);
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }

    // Render table untuk menampilkan data transaksi
    function renderTable(data) {
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = ''; // Clear previous table rows
      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row[0]}</td>
          <td>${row[1]}</td>
          <td>${row[2]}</td>
          <td>${row[3]}</td>
          <td class="text-end">${row[4]}</td>
          <td class="text-end"><button class="btn btn-sm btn-outline-danger" onclick="deleteTransaction(${row[0]})">Hapus</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Fungsi untuk menghapus transaksi
    function deleteTransaction(id) {
      const params = new URLSearchParams();
      params.append('action', 'deleteTransaction');
      params.append('id', id);

      fetch(WEB_APP_URL, {
        method: 'POST',
        body: params
      })
      .then(response => response.json())
      .then(result => {
        console.log('Data berhasil dihapus:', result);
        fetchDataFromGoogleSheets();
      })
      .catch(error => {
        console.error('Error:', error);
      });
    }

    // Handle form submission
    document.getElementById('formKas').addEventListener('submit', function(e) {
      e.preventDefault();

      const data = {
        tgl: document.getElementById('tgl').value,
        tipe: document.getElementById('tipe').value,
        kategori: document.getElementById('kategori').value,
        keterangan: document.getElementById('keterangan').value,
        jumlah: document.getElementById('jumlah').value
      };

      saveDataToGoogleSheets(data);
    });

    // Fetch data saat halaman dimuat
    window.onload = function() {
      fetchDataFromGoogleSheets();
    };
  </script>
</body>
</html>
