<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laporan Kas Masjid</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f8fafc;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* === Sticky Header Container === */
    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 200;
      background: #f8fafc;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.8em;
      color: #111827;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }

    select, input, button {
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    .summary {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }

    .card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 10px 20px;
      min-width: 200px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .card p {
      margin: 0;
      font-size: 13px;
      color: #6b7280;
    }

    .card h3 {
      margin: 5px 0 0;
      font-size: 16px;
    }

    .table-container {
      flex: 1;
      padding: 20px;
      overflow-x: auto;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
      font-size: 14px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      table-layout: fixed;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px 6px;
      text-align: center;
      word-wrap: break-word;
    }

    /* Header tabel juga sticky (selalu terlihat) */
    thead th {
      position: sticky;
      top: 160px; /* tinggi kira-kira dari sticky-header */
      background: #f1f5f9;
      font-weight: bold;
      z-index: 150;
    }

    th:nth-child(1), td:nth-child(1) { width: 15%; }
    th:nth-child(2), td:nth-child(2) { width: 35%; text-align: left; }
    th:nth-child(3), td:nth-child(3),
    th:nth-child(4), td:nth-child(4),
    th:nth-child(5), td:nth-child(5) { width: 16%; text-align: right; }

    .green { color: #047857; font-weight: bold; }
    .red { color: #b91c1c; font-weight: bold; }
    .blue { color: #1d4ed8; font-weight: bold; }

    /* === Footer === */
    footer {
      text-align: center;
      background: #fff;
      color: #4b5563;
      font-size: 14px;
      padding: 15px 10px;
      border-top: 1px solid #e5e7eb;
      box-shadow: 0 -1px 6px rgba(0,0,0,0.05);
    }

    footer span {
      font-style: italic;
      color: #1e3a8a;
      transition: opacity 0.8s ease-in-out;
    }

    @media (max-width: 768px) {
      thead { display: none; }
      table, tbody, th, td, tr { display: block; }
      tr {
        margin-bottom: 15px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        padding: 10px;
      }
      td {
        text-align: right;
        border: none;
        display: flex;
        justify-content: space-between;
        padding: 5px 10px;
      }
      td::before {
        content: attr(data-label);
        font-weight: bold;
        text-align: left;
      }
    }
  </style>
</head>
<body>

  <!-- === Bagian Sticky Header === -->
  <div class="sticky-header">
    <h1>Laporan Kas Masjid</h1>

    <div class="filters">
      <select id="bulanSelect">
        <option value="Semua">Semua Bulan</option>
        <option>Januari</option><option>Februari</option><option>Maret</option>
        <option>April</option><option>Mei</option><option>Juni</option>
        <option>Juli</option><option>Agustus</option><option>September</option>
        <option>Oktober</option><option>November</option><option>Desember</option>
      </select>

      <select id="tahunSelect">
        <option value="Semua">Semua Tahun</option>
        <option>2024</option><option>2025</option>
      </select>

      <input type="text" id="searchInput" placeholder="Cari keterangan...">
      <button onclick="resetFilter()">Reset</button>
    </div>

    <div class="summary">
      <div class="card">
        <p>Total Pemasukan</p>
        <h3 id="totalPemasukan" class="green">Rp 0</h3>
      </div>
      <div class="card">
        <p>Total Pengeluaran</p>
        <h3 id="totalPengeluaran" class="red">Rp 0</h3>
      </div>
      <div class="card">
        <p>Saldo Terakhir</p>
        <h3 id="saldoTerakhir" class="blue">Rp 0</h3>
      </div>
    </div>
  </div>

  <!-- === Tabel === -->
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Tanggal</th>
          <th>Keterangan</th>
          <th>Pemasukan</th>
          <th>Pengeluaran</th>
          <th>Saldo</th>
        </tr>
      </thead>
      <tbody id="dataBody">
        <tr><td colspan="5">Memuat data...</td></tr>
      </tbody>
    </table>
  </div>

  <!-- === Footer === -->
  <footer>
    <p><span id="hadistText">“Sedekah tidak akan mengurangi harta.” – (HR. Muslim)</span></p>
  </footer>

  <script>
    // ==== DATA HADIST / MOTIVASI ====
    const hadistList = [
      "“Sedekah tidak akan mengurangi harta.” – (HR. Muslim)",
      "“Senyummu kepada saudaramu adalah sedekah.” – (HR. Tirmidzi)",
      "“Barang siapa menempuh jalan untuk mencari ilmu, maka Allah akan memudahkan baginya jalan menuju surga.” – (HR. Muslim)",
      "“Sebaik-baik manusia adalah yang paling bermanfaat bagi manusia lain.” – (HR. Ahmad)",
      "“Allah tidak melihat rupa dan harta kalian, tetapi hati dan amal kalian.” – (HR. Muslim)",
      "“Doa adalah senjata orang beriman.” – (HR. Al-Hakim)",
      "“Tangan di atas lebih baik daripada tangan di bawah.” – (HR. Bukhari)",
      "“Barang siapa bersyukur, maka Aku akan menambah nikmatnya.” – (QS. Ibrahim: 7)",
      "“Kesabaran adalah cahaya.” – (HR. Muslim)",
      "“Barang siapa bertakwa kepada Allah, niscaya Dia akan memberikan jalan keluar.” – (QS. Ath-Thalaq: 2)",
      "“Ikhlaslah, meski tak terlihat oleh manusia.”",
      "“Sesungguhnya setelah kesulitan ada kemudahan.” – (QS. Al-Insyirah: 6)",
      "“Perbanyaklah mengingat Allah, maka hatimu akan tenang.” – (QS. Ar-Ra’d: 28)",
      "“Barang siapa memudahkan urusan orang lain, Allah akan memudahkannya di dunia dan akhirat.” – (HR. Muslim)",
      "“Harta bukanlah banyaknya kepemilikan, tetapi hati yang merasa cukup.” – (HR. Bukhari)",
      "“Jangan bersedih, sesungguhnya Allah bersama kita.” – (QS. At-Taubah: 40)",
      "“Amal yang paling dicintai Allah adalah yang terus-menerus meskipun sedikit.” – (HR. Bukhari)",
      "“Barang siapa beriman kepada Allah dan hari akhir, hendaklah ia berkata baik atau diam.” – (HR. Bukhari)",
      "“Shalat adalah tiang agama.” – (HR. Thabrani)",
      "“Barang siapa memaafkan, maka Allah akan memuliakannya.” – (HR. Muslim)",
      "“Ingatlah Allah di waktu lapang, niscaya Dia akan mengingatmu di waktu sempit.” – (HR. Ahmad)",
      "“Kaya bukan karena banyak harta, tapi karena hati yang puas.” – (HR. Bukhari)",
      "“Sabar adalah separuh dari iman.” – (HR. Thabrani)",
      "“Barang siapa berbuat baik sebesar zarrah pun, niscaya ia akan melihat (balasannya).” – (QS. Az-Zalzalah: 7)",
      "“Bersihkan hartamu dengan zakat.”",
      "“Cintailah orang lain sebagaimana engkau mencintai dirimu sendiri.” – (HR. Bukhari)",
      "“Allah mencintai orang yang bertobat dan menyucikan diri.” – (QS. Al-Baqarah: 222)",
      "“Tiada kebaikan pada manusia yang tidak ingin memberi manfaat.”",
      "“Sedikit tapi berkah lebih baik daripada banyak tapi lalai.”",
      "“Jangan lupa bersyukur, karena nikmat kecil pun berasal dari-Nya.”"
    ];

    // Ganti teks footer setiap 10 detik
    const hadistElement = document.getElementById("hadistText");
    let index = 0;
    setInterval(() => {
      hadistElement.style.opacity = 0;
      setTimeout(() => {
        index = (index + 1) % hadistList.length;
        hadistElement.innerText = hadistList[index];
        hadistElement.style.opacity = 1;
      }, 800);
    }, 10000);

    // === Data Spreadsheet ===
    const SHEET_ID = "1QgoEgvEHab29CMkmv8EXFruCC_nGADoY";
    const SHEET_NAME = "Laporan Kas Masjid";
    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
    let allData = [];

    fetch(URL)
      .then(res => res.text())
      .then(text => {
        const start = text.indexOf('{');
        const end = text.lastIndexOf('}');
        const json = JSON.parse(text.slice(start, end + 1));
        allData = json.table.rows.map(r => ({
          tanggal: r.c[0]?.v || '',
          keterangan: r.c[1]?.v || '',
          pemasukan: parseFloat(r.c[2]?.v || 0),
          pengeluaran: parseFloat(r.c[3]?.v || 0),
          saldo: parseFloat(r.c[4]?.v || 0)
        }));
        renderTable();
      })
      .catch(err => {
        document.getElementById('dataBody').innerHTML = `<tr><td colspan='5'>⚠️ Gagal memuat data (${err.message})</td></tr>`;
      });

    function renderTable() {
      const bulan = bulanSelect.value;
      const tahun = tahunSelect.value;
      const search = searchInput.value.toLowerCase();

      const filtered = allData.filter(i => {
        const d = new Date(i.tanggal);
        const m = d.toLocaleString('id-ID', { month: 'long' });
        const y = d.getFullYear().toString();
        return (bulan === 'Semua' || m === bulan) &&
               (tahun === 'Semua' || y === tahun) &&
               i.keterangan.toLowerCase().includes(search);
      });

      const tbody = document.getElementById('dataBody');
      if (!filtered.length) {
        tbody.innerHTML = `<tr><td colspan='5'>Tidak ada data untuk periode ini.</td></tr>`;
        updateSummary(0, 0, 0);
        return;
      }

      let pemasukan = 0, pengeluaran = 0, saldo = 0;
      tbody.innerHTML = filtered.map(i => {
        pemasukan += i.pemasukan;
        pengeluaran += i.pengeluaran;
        saldo = i.saldo;
        return `
          <tr>
            <td data-label="Tanggal">${i.tanggal}</td>
            <td data-label="Keterangan">${i.keterangan}</td>
            <td data-label="Pemasukan" class="green">Rp ${i.pemasukan.toLocaleString()}</td>
            <td data-label="Pengeluaran" class="red">Rp ${i.pengeluaran.toLocaleString()}</td>
            <td data-label="Saldo" class="blue">Rp ${i.saldo.toLocaleString()}</td>
          </tr>`;
      }).join('') + `
        <tr style="background:#f1f5f9;font-weight:bold;">
          <td colspan="2" style="text-align:center;">Total</td>
          <td class="green">Rp ${pemasukan.toLocaleString()}</td>
          <td class="red">Rp ${pengeluaran.toLocaleString()}</td>
          <td class="blue">Rp ${saldo.toLocaleString()}</td>
        </tr>`;

      updateSummary(pemasukan, pengeluaran, saldo);
    }

    function updateSummary(p, q, s) {
      totalPemasukan.innerText = `Rp ${p.toLocaleString()}`;
      totalPengeluaran.innerText = `Rp ${q.toLocaleString()}`;
      saldoTerakhir.innerText = `Rp ${s.toLocaleString()}`;
    }

    bulanSelect.onchange = tahunSelect.onchange = searchInput.oninput = renderTable;
    function resetFilter() {
      bulanSelect.value = 'Semua';
      tahunSelect.value = 'Semua';
      searchInput.value = '';
      renderTable();
    }
  </script>
</body>
</html>
